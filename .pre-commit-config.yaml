repos:

# ===================== PREPARE REPORTS DIR + TIMESTAMP =====================
- repo: local
  hooks:
    - id: prepare-precommit-context
      name: Prepare pre-commit context
      entry: bash -c 'mkdir -p reports/precommit && date +"%Y%m%d-%H%M%S" > reports/precommit/.run_id'
      language: system
      pass_filenames: false

# ===================== SAST (BANDIT) =====================
- repo: https://github.com/pycqa/bandit
  rev: 1.7.5
  hooks:
    - id: bandit
      name: Bandit SAST (pre-commit)
      entry: bash -c 'RUN_ID=$(cat reports/precommit/.run_id) && bandit -ll -r backend -f json -o reports/precommit/bandit-${RUN_ID}.json'
      pass_filenames: false

# ===================== SECRETS (GITLEAKS) =====================
- repo: https://github.com/gitleaks/gitleaks
  rev: v8.18.0
  hooks:
    - id: gitleaks
      name: Gitleaks Secret Scan (pre-commit)
      entry: bash -c 'RUN_ID=$(cat reports/precommit/.run_id) && gitleaks detect --source . --report-format json --report-path reports/precommit/gitleaks-${RUN_ID}.json'
      pass_filenames: false

# ===================== FORMATTER =====================
- repo: https://github.com/psf/black
  rev: 24.3.0
  hooks:
    - id: black
      name: Black Code Formatter
